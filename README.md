# README

## 概要
このプログラムは、3次元空間におけるリンク構造（ロボットアーム）のモデリングと、光源による影の投影をMATLABを用いて可視化するものです。リンクは階層的に構成され、影も正確に地面に投影されるよう計算されています。また、アニメーションによりリンクの動きをシミュレートします。

---

## 必要な数学的・プログラム的知識

### 1. **3次元座標変換**
3次元空間で物体を移動・回転させるために、以下の座標変換が必要です：
- **平行移動（Translation）**:
  - 物体を特定の方向に移動。
  - 行列形式：
    \[
    T = \begin{bmatrix}
    1 & 0 & 0 & tx \\
    0 & 1 & 0 & ty \\
    0 & 0 & 1 & tz \\
    0 & 0 & 0 & 1
    \end{bmatrix}
    \]
  - `makehgtform('translate', [tx, ty, tz])` を使用。

- **回転（Rotation）**:
  - 物体を特定の軸で回転。
  - 回転行列の例（z軸回り）：
    \[
    R_z = \begin{bmatrix}
    \cos\theta & -\sin\theta & 0 & 0 \\
    \sin\theta & \cos\theta & 0 & 0 \\
    0 & 0 & 1 & 0 \\
    0 & 0 & 0 & 1
    \end{bmatrix}
    \]
  - `makehgtform('xrotate', angle)` などを使用。

- **合成変換**:
  - 平行移動と回転を組み合わせて物体を変換。

### 2. **影の投影**
影の計算は以下の流れで行います：
1. **光源から頂点へのベクトルを計算**。
2. **地面と光源からの直線との交点を求める**。
   - スケール係数 \( t \) を用いて影の位置を計算：
     \[
     t = \frac{Z_{\text{ground}} - Pz}{Lz - Pz}
     \]
   - 影の座標：
     \[
     Sx = Px + t \cdot (Lx - Px), \quad Sy = Py + t \cdot (Ly - Py), \quad Sz = Z_{\text{ground}}
     \]

3. **影を描画**：
   - `surf` を用いて地面上に影をプロット。

### 3. **MATLABのグラフィックシステム**
- **`hgtransform`**:
  - 階層的な座標変換を実現するために使用。
  - リンク（物体）は親子関係を持ち、親の座標変換が子にも適用されます。

- **アニメーション**:
  - `set` 関数を用いてオブジェクトのプロパティを更新し、動的に可視化。

---

## プログラム構成

### メインスクリプト
1. **3次元空間の設定**:
   - 座標軸、光源、地面の描画。
2. **リンク構造の作成**:
   - リンクを `hgtransform` を用いて階層的に定義。
3. **座標変換**:
   - 初期位置や回転の設定。
4. **影の投影**:
   - 各リンクの影を計算し地面に描画。
5. **アニメーション**:
   - ヨー角（回転角度）を更新して動きをシミュレート。

### 関数
- **`createCylinder`**:
  円柱形状を生成し、リンクとして描画。

- **`projectShadow`**:
  各リンクの影を計算して描画。

- **`updateShadow`**:
  既存の影の位置を更新。

- **`hgtransformChainMatrix`**:
  階層的な変換行列を計算。

- **`make3dRotation`**:
  3軸の回転行列を生成。

---

## 使用方法
1. MATLAB環境でスクリプトを実行します。
2. アニメーションが開始され、リンクが回転し、それに伴って影も動きます。
3. 必要に応じてリンクの長さ、光源の位置、回転速度などを調整してください。

---

## 応用例
- ロボットアームの動作シミュレーション。
- 光源と影を伴う3次元物体の可視化。
- 教育用途（座標変換や影の計算の学習）。

---

## 注意点
- プログラムはMATLAB環境が必要です。
- 光源やリンクの位置によっては、影が正しく表示されない場合があります。その際は、リンクの変換行列や光源の位置を確認してください。
